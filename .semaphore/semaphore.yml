version: v1.0
name: flax
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: "main"
    task:
      jobs:
      - name: main
        commands:
          - checkout
          - echo "LLVM 7"
          - sudo echo "deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-7 main" | sudo tee -a /etc/apt/sources.list
          - sudo echo "deb-src http://apt.llvm.org/bionic/ llvm-toolchain-bionic-7 main" | sudo tee -a /etc/apt/sources.list
          - sudo wget -O - http://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -
          - sudo apt -y update
          - sudo apt-get -o Dpkg::Options::="--force-overwrite" --allow-unauthenticated -y install -y llvm-7 llvm-7-dev libllvm7 libmpfr-dev libmpfr6
          - CXX=g++-8 CC=gcc-8 LLVM_CONFIG=llvm-config-7 make -j2 test
